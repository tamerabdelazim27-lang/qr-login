<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مسح كرت الواي فاي</title>

<style>
body{
    margin:0;
    font-family: Arial, Tahoma;
    background:#f5f7fb;
    display:flex;
    align-items:center;
    justify-content:center;
    height:100vh;
}
.box{
    background:#fff;
    width:360px;
    padding:20px;
    border-radius:16px;
    box-shadow:0 10px 30px rgba(0,0,0,.1);
    text-align:center;
}
h2{
    margin:10px 0 5px;
    color:#1e88e5;
}
p{
    margin:0 0 15px;
    color:#555;
    font-size:14px;
}
video{
    width:100%;
    border-radius:12px;
    border:3px solid #1e88e5;
}
.status{
    margin-top:10px;
    font-size:14px;
    color:#1e88e5;
}
</style>
</head>

<body>

<div class="box">
    <h2>مسح كرت الواي فاي</h2>
    <p>وجه الكاميرا على الكيو آر</p>
    <video id="video" autoplay playsinline></video>
    <div class="status" id="status">جاري فتح الكاميرا...</div>
</div>

<script>
const video = document.getElementById("video");
const statusText = document.getElementById("status");

async function startCamera(){
    try{
        const stream = await navigator.mediaDevices.getUserMedia({
            video:{ facingMode:"environment" }
        });
        video.srcObject = stream;
        statusText.innerText = "امسح الكيو آر الآن";
        startScan();
    }catch(e){
        statusText.innerText = "فشل فتح الكاميرا";
    }
}

async function startScan(){
    if(!("BarcodeDetector" in window)){
        statusText.innerText = "المتصفح غير مدعوم";
        return;
    }

    const detector = new BarcodeDetector({ formats:["qr_code"] });

    setInterval(async ()=>{
        try{
            const barcodes = await detector.detect(video);
            if(barcodes.length){
                const val = encodeURIComponent(barcodes[0].rawValue.trim());
                window.location.href =
                  "http://10.10.10.1/login?username=" + val + "&password=" + val;
            }
        }catch(e){}
    },500);
}

startCamera();
</script>

</body>
</html>
